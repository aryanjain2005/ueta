---
import Layout from '@layouts/Layout.astro'
import Container from '@components/container.astro'
import Description from '@components/description.astro'
import PbList from '@components/pb-list'
import ScrollView from '@components/ui/scroll-view.astro'
import PbItem from '@components/cards/pb-item'
import Link from '@components/ui/link.astro'
import DDItem from '@components/cards/dd-item'
import type { Brand } from 'types'
import { drizzle } from 'drizzle-orm/d1'
import * as schema from 'db/schema'
import { eq } from 'drizzle-orm'
import { VITE_API_URL } from 'constant'
interface Props {
  entry: Brand
}
export async function getBrand(slug: string) {
  const req = await fetch(`${VITE_API_URL}/brands/${slug}`)
  return (await req.json()) as Brand
}
const { slug } = Astro.params
if (!slug) return Astro.redirect('/404')
const entry = await getBrand(slug)
if (!entry) return Astro.redirect('/404')
---

<Layout title={entry.name} bread={['brand', entry.name]}>
  <Container class='py-12'>
    <h2 class='text-4xl font-bold tracking-tight px-16 mb-4'>
      {entry.name}
    </h2>
    <Description
      title={entry.name}
      description={entry.description}
      image={entry.image}
    />
    <div class='px-8 space-y-16 mt-12'>
      <PbList
        client:load
        list={entry.products}
        type='product'
        useDialog={true}
      />

      <div class='flex flex-col gap-6 items-center'>
        <h3
          class='text-5xl font-extrabold text-[#003DA6] text-center w-full font-gr'>
          {`Dealers of ${entry.name}`}
        </h3>
        <ScrollView>
          {
            entry.dealers
              .slice(0, 6)
              .map((dealer) => (
                <DDItem client:load bussiness={dealer} useDialog={true} />
              ))
          }
        </ScrollView>
        {
          entry.distributors.length > 6 && (
            <Link
              target='_blank'
              href={`/dealer?brand=${entry.slug}`}
              class='w-fit text-xs'>
              VIEW ALL DEALERS
            </Link>
          )
        }
      </div>
      <div
        class='bg-gradient-to-r from-transparent via-[#003da6] to-transparent h-0.5 w-full'>
      </div>
      <div class='flex flex-col gap-6 items-center'>
        <h3
          class='text-5xl font-extrabold text-[#003DA6] text-center w-full font-gr'>
          {`Distributors of ${entry.name}`}
        </h3>
        <ScrollView>
          {
            entry.distributors
              .slice(0, 6)
              .map((distributor) => (
                <DDItem client:load bussiness={distributor} useDialog={true} />
              ))
          }
        </ScrollView>
        {
          entry.distributors.length > 6 && (
            <Link
              target='_blank'
              href={`/distributors?brand=${entry.slug}`}
              class='w-fit text-xs'>
              VIEW ALL DISTRIBUTORS
            </Link>
          )
        }
      </div>
      <div class='space-y-4 text-lg font-bold w-full'>
        <p>More Brands</p>
        <ScrollView>
          {
            entry.moreBrands.map((data) => (
              <PbItem type='brand' pb={data} size='small' shadow={true} />
            ))
          }
        </ScrollView>
      </div>
    </div>
  </Container>
</Layout>
