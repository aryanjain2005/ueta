---
import DdInfo from '@components/dd-info.astro'
import ProdList from '@components/prod-list'
import Layout from '@layouts/Layout.astro'
import { VITE_API_URL } from 'constant'
import type { Business } from 'types'

export const getDealer = async (slug: string) => {
  const req = await fetch(`${VITE_API_URL}/dealers/${slug}`)
  return (await req.json()) as Business<'dealer'>
}
const { slug } = Astro.params
if (!slug) return Astro.redirect('/404')
const entry = await getDealer(slug)
if (!entry) return Astro.redirect('/404')
---

<Layout title={entry.name} bread={['dealer', entry.name]}>
  <DdInfo name={entry.name} image={entry.images} />
  <ProdList client:load brands={entry.brands} />
</Layout>
